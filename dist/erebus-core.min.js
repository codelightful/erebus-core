!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Erebus=t()}(this,(function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?o:String(o)),r)}var i,o}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,u(e,t,"get"))}function s(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,u(e,t,"set"),n),n}function u(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function c(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function l(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(e,t,n){l(e,t),t.set(e,n)}var h={isPromise:function(t){return!!t&&(t instanceof Promise||e("function"===t.then)&&"function"==typeof t.catch)},trim:function(e){return"string"!=typeof e?e:e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},d={};function p(){return(65536*(1+Math.random())|0).toString(16).substring(1)}d.set=function(e,t,n){if(!e)throw Error("erebus.cookies.set.null_cookie_name");"number"!=typeof n&&(n=3600);var r=new Date;r.setTime(r.getTime()+1e3*n);var i=h.trim(e)+"="+t+"; expires="+r.toGMTString()+"; path=/";document.cookie=i},d.get=function(e){if(!e)return null;var t=RegExp(e+"=[^;]+").exec(document.cookie);return t?decodeURIComponent(t.toString().replace(/^[^=]+./,"")):""};var v={tinyId:p,shortId:function(){return p()+p()},guid:function(){return p()+"-"+p()+"-"+p()+"-"+p()+p()}},y={};y.documentReady=function(){return"loading"!==document.readyState?Promise.resolve():"function"==typeof document.addEventListener?new Promise((function(e){document.addEventListener("DOMContentLoaded",e,!1)})):"function"==typeof document.attachEvent?new Promise((function(e){document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))})):(console.error("The current browser event management is not supported by the Erebus framework"),Promise.reject("erebus.events.unsuported_browser"))},y.animate=function(e,t){return e?t?new Promise((function(n){e.addEventListener("animationend",(function(){n()}),{capture:!1,once:!0}),""===e.className?e.className=t:e.classList?e.classList.add(t):"function"==typeof e.addClass?e.addClass(t):e.className+=" "+t})):Promise.reject("erebus.events.wait_animation.invalid_animation"):Promise.reject("erebus.events.wait_animation.invalid_target")};var m={trigger:function(e){if(null!=e){if("function"!=typeof e)throw new Error("erebus.handler.trigger.invalid_function");try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.call.apply(e,[null].concat(n))}catch(e){throw new Error("erebus.handlers.trigger.function_error",e)}}},triggerAsPromise:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return null==e?Promise.resolve():"function"!=typeof e?Promise.reject("erebus.handler.trigger_promise_function.invalid_function"):new Promise((function(t,r){try{t(e.call.apply(e,[null].concat(n)))}catch(e){console.error("erebus.handlers.trigger_promise_function.function_error",e),r(e)}}))}},g={},w={};function b(e,t,n){return"string"==typeof t&&t?(n||(n={}),e||(e="GET"),new Promise((function(r,i){var o=function(){if(window.XMLHttpRequest)return new window.XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("erebus.http.xmlhttp_error")}}}();o.onreadystatechange=function(){if(4==o.readyState||"complete"===o.readyState)if(200!==o.status){var e=new Error("http_error["+o.status+"]");e.status=o.status,e.response=o.responseText,i(e)}else{var t=o.responseText,a=function(e){var t={},n=e.getAllResponseHeaders();if(n){n=n.split("\r\n");for(var r=0;r<n.length;r++)if(n[r]){var i=n[r].split(":"),o=h.trim(i[0]).toLowerCase(),a=h.trim(i[1]);o&&a&&(t[o]=a)}}return t}(o),s=function(e){return e&&"application/json"===e["content-type"]?w.parsers.json:null}(a);if(s)try{t=s(t)}catch(e){return void i(e)}if("function"==typeof n.interceptor){var u=n.interceptor(t,a);void 0!==u&&(t=u)}r(t)}},o.open(e,t,!1!==n.async),function(e,t){if(t)for(var n in t)e.setRequestHeader(n,t[n])}(o,n.headers),"GET"!==e&&n.data?o.send(n.data):o.send()}))):Promise.reject("erebus.http.null_url")}w.parsers={},w.parsers.json=function(e){try{return JSON.parse(e)}catch(n){var t=new Error("erebus.http.json_parse_error");throw t.cause=n,t.response=e,t}},g.get=function(e,t){return b("GET",e,t)},g.post=function(e,t){return b("POST",e,t)},g.put=function(e,t){return b("PUT",e,t)},g.delete=function(e,t){return b("DELETE",e,t)},g.loadScript=function(e){return new Promise((function(t){var n=document.createElement("script");n.src=e,n.type="text/javascript",n.async=!1,n.onerror=function(){},n.onload=function(){t()},document.head.appendChild(n)}))};var E={};function k(e){if(!e||"string"!=typeof e)return[];var t=document.createElement("div");return t.innerHTML=e,i(t.childNodes)}function _(e){if(e&&e instanceof HTMLElement)for(;e.firstChild;)e.removeChild(e.firstChild)}function L(e){if(!(e&&e instanceof HTMLElement))return null;var t=e.cloneNode(!0);return 1===t.nodeType&&t.removeAttribute("id"),t}function T(e){if(!e)return null;if(e instanceof C)return e;if("body"===e||e===document.body)return E.body||(E.body=new C(document.body)),E.body;if(e instanceof HTMLElement)return new C(e);if("string"==typeof e){var t;if(e.startsWith("<")&&e.endsWith(">"))t=k(e);else if(e.startsWith("#")){if(!(t=document.getElementById(e.substring(1))))throw Error("erebus.element.unknown_element_id[".concat(e,"]"))}else if(0===(t=document.querySelectorAll(e)).length)throw Error("erebus.element.unknown_selector[".concat(e,"]"));return new C(t)}}var P=new WeakMap,M=new WeakMap,C=function(){function n(r){if(t(this,n),f(this,P,{writable:!0,value:void 0}),f(this,M,{writable:!0,value:void 0}),s(this,M,!1),r instanceof HTMLElement)s(this,P,[]),a(this,P).push(r);else if(r instanceof NodeList)s(this,P,Array.from(r));else{if(!Array.isArray(r))throw Error("erebus.element.unknown_type["+e(r)+"]");s(this,P,r)}}return r(n,[{key:"each",value:function(e){for(var t=0;t<a(this,P).length;t++){if(!1===e(a(this,P)[t],t))break}}},{key:"innerHTML",set:function(e){this.each((function(t){t.innerHTML=e}))}},{key:"clear",value:function(){return this.each((function(e){e.innerHTML="",_(e)})),this}},{key:"content",value:function(e){return this.each((function(t,r){"string"==typeof e?t.innerHTML=e:e instanceof HTMLElement?(t.innerHTML="",_(t),0===r?t.appendChild(e):t.appendChild(L(e))):e instanceof n&&(t.innerHTML="",_(t),0===r?e.setParentNode(t):e.clone().setParentNode(t))})),this}},{key:"setParentNode",value:function(t){if(!t)return this.each((function(e){e.parentNode&&e.parentNode.removeChild(e)})),this;if("string"==typeof t)t=T(t);else if("function"!=typeof t.appendChild)throw Error("erebus.wrapper.append_to.invalid_parent["+e(t)+"]");return this.each((function(e){t.appendChild(e)})),this}},{key:"parentNode",set:function(e){this.setParentNode(e)}},{key:"appendChild",value:function(e){if("string"==typeof e){var t=k(e);this.each((function(e,n){for(var r=0;r<t.length;r++){var i=t[r];0===n?e.appendChild(i):e.appendChild(L(i))}}))}else this.each((function(t,r){e instanceof HTMLElement?0===r?t.appendChild(e):t.appendChild(L(e)):e instanceof n&&e.each((function(e){0===r?t.appendChild(e):t.appendChild(L(e))}))}));return this}},{key:"addEventListener",value:function(e,t,n){if(!e)throw Error("erebus.element.add_listener.null_event_name");return"function"==typeof t&&(void 0===n&&(n={capture:!1}),this.each((function(r){r.addEventListener(e,t,n)}))),this}},{key:"once",value:function(e,t){return this.addEventListener(e,t,{capture:!1,once:!0})}},{key:"isHidden",get:function(){return a(this,M)}},{key:"hide",value:function(){a(this,M)||(s(this,M,!0),this.each((function(e){var t=getComputedStyle(e).getPropertyValue("display");t&&"none"!==t&&(e.originalDisplay=t),e.style.display="none"})))}},{key:"show",value:function(){s(this,M,!1),this.each((function(e){var t=getComputedStyle(e).getPropertyValue("display");t&&"none"!==t||(e.originalDisplay?(e.style.display=e.originalDisplay,delete e.originalDisplay):e.style.display="block")}))}},{key:"clone",value:function(){var e=[];return this.each((function(t){e.push(L(t))})),new n(e)}},{key:"addClass",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t&&0!==t.length?(this.each((function(e){for(var n=0;n<t.length;n++){var r=h.trim(t[n]);if(r&&"string"==typeof r)if(e.className)if(e.classList)e.classList.add(r);else{new RegExp("(^|\\s)("+r+")($|\\s)","g").test(e.className)||(e.className+=" "+r)}else e.className=r}})),this):this}},{key:"removeClass",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t&&0!==t.length?(this.each((function(e){if(e.className)for(var n=0;n<t.length;n++){var r=h.trim(t[n]);if(r&&"string"==typeof r){var i=new RegExp("(^|\\s)("+r+")($|\\s)","g");i.test(e.className)&&(e.className=e.className.replace(i,""))}}})),this):this}},{key:"className",set:function(e){e=h.trim(e),this.each((function(t){t.className=e}))}},{key:"load",value:function(e){var t=this;return g.get(e).then((function(e){t.content(e)})).catch((function(e){var n=v.shortId();console.error("erebus.element.load_error[".concat(n,"]"),e),t.content("<div>Error[".concat(n,"]</div>"))}))}}]),n}(),S={};function N(){return navigator.language?navigator.language:navigator.browserLanguage?navigator.browserLanguage:"en-US"}function j(){return N().substr(0,2)}function A(){return S.language?S.language:j()}S.language=null,S.resources={};var H={getLocale:N,getSystemLanguage:j,setLanguage:function(e){S.language=e},getLanguage:A,setResourceBundle:function e(t,n){if(!t)return Promise.resolve();if(n||(n=A()),"function"==typeof t)return e(m.trigger(t),n);if(h.isPromise(t))return t.then((function(t){return e(t,n)})).catch((function(e){var t=Error("erebus.i18n.promise_resource_error");throw t.cause=e,t}));var r=S.resources[n];return r?Object.assign(r,t):S.resources[n]=t,Promise.resolve()},getLabel:function(e,t){var n=A(),r=S.resources[n];return r&&r[e]?r[e]:null!=t?t:e}};function W(e){return e&&"string"==typeof e&&(e.startsWith("#")&&(e=e.substring(1)),e.startsWith("/")&&(e=e.substring(1))),e}var x=new WeakMap,R=new WeakMap,O=function(){function e(n,r){t(this,e),f(this,x,{writable:!0,value:void 0}),f(this,R,{writable:!0,value:void 0}),s(this,x,W(n)),s(this,R,r)}return r(e,[{key:"match",value:function(e){return e=W(e),"string"==typeof a(this,x)?function(e,t){if("*"===e||e===t)return!0;for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length;i++)if(!n[i].startsWith(":")&&"*"!==n[i]&&n[i]!==r[i])return!1;return!0}(a(this,x),e):a(this,x)instanceof RegExp&&a(this,x).test(e)}},{key:"handle",value:function(e){var t=this;return a(this,R)?new Promise((function(n,r){e=W(e);try{var i=function(e,t){for(var n={},r=e.split("/"),i=t.split("/"),o=0;o<r.length;o++)r[o].startsWith(":")&&(n[r[o].substring(1)]=i[o]);return n}(a(t,x),e),o=a(t,R).call(t,i);o instanceof Promise?o.then(n).catch(r):n()}catch(e){console.error("erebus.route.handler_error",e),r(e)}})):Promise.reject(new Error("erebus.route.no_handler[".concat(e,"]")))}}]),e}();var I=new WeakMap,D=new WeakMap,F=new WeakMap,U=new WeakMap,X=new WeakSet,q=function(){function e(){var n,r;t(this,e),l(n=this,r=X),r.add(n),f(this,I,{writable:!0,value:[]}),f(this,D,{writable:!0,value:!1}),f(this,F,{writable:!0,value:void 0}),f(this,U,{writable:!0,value:void 0})}return r(e,[{key:"register",value:function(e,t){if(!t||"function"!=typeof t)throw Error("erebus.router.invalid_handler[".concat(e,"]"));return a(this,I).push(new O(e,t)),this}},{key:"serve",value:function(e){var t=this;return void 0===e&&(e=null),e=W(e),new Promise((function(n,r){var i=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.match(t))return r}return null}(a(t,I),e);i||(i=a(t,F)),i?i.handle(e).then((function(){n(!0)})).catch(r):r("erebus.route.no_matching_route_or_default")}))}},{key:"start",value:function(){var e=this;a(this,D)?console.warn("erebus.router.already_started"):(s(this,D,!0),window.addEventListener("popstate",(function(){c(e,X,G).call(e)})),c(this,X,G).call(this))}},{key:"default",value:function(e){if(!e)return s(this,F,null),this;if("function"!=typeof e)throw console.error("Unable to register a non-function as a default handler for Erebus router"),new Error("erebus.router.invalid_default_handler");return s(this,F,new O("*",e)),this}},{key:"error",value:function(e){if(!e)return s(this,U,null),this;if("function"!=typeof e)throw console.error("Unable to register a non-function as an error handler for Erebus router"),new Error("erebus.router.invalid_error_handler");return s(this,U,e),this}}]),e}();function G(){var e=this;this.serve(window.location.hash).then((function(){})).catch((function(t){console.error("erebus.router.error",t),a(e,U)&&a(e,U).call(e,t)}))}var $=new q;return console.log("Erebus Core v0.0.17"),{utils:h,cookies:d,random:v,events:y,handler:m,element:T,http:g,i18n:H,router:$}}));
//# sourceMappingURL=erebus-core.min.js.map
